<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <title>Teste WebSocket Bun</title>
</head>

<body>
  <h1>WebSocket Test</h1>

  <div style="margin-bottom: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
    <h2>Valor Compartilhado: <span id="valorDisplay">0</span></h2>
    <input id="valorInput" type="number" placeholder="Novo valor" />
    <button id="updateValor">Atualizar Valor</button>
  </div>

  <input id="msg" placeholder="Digite uma mensagem" />
  <button id="send">Enviar</button>

  <pre id="log"></pre>

  <script>
    const logEl = document.getElementById("log");
    const input = document.getElementById("msg");
    const btn = document.getElementById("send");
    const valorDisplay = document.getElementById("valorDisplay");
    const valorInput = document.getElementById("valorInput");
    const updateValorBtn = document.getElementById("updateValor");

    const ws = new WebSocket("ws://localhost:3000");

    ws.onopen = () => {
      logEl.textContent += "âœ… Conectado\n";
    };

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);

        if (data.type === "valor") {
          valorDisplay.textContent = data.valor;
          return;
        }
      } catch {
        // NÃ£o Ã© JSON, Ã© mensagem normal
      }

      logEl.textContent += `ðŸ“¥ ${event.data}\n`;
    };

    ws.onclose = () => {
      logEl.textContent += "âŒ Desconectado\n";
    };

    btn.onclick = () => {
      const text = input.value;
      if (!text) return;
      ws.send(text);
      input.value = "";
    };

    updateValorBtn.onclick = () => {
      const valor = parseFloat(valorInput.value);
      if (isNaN(valor)) return;
      ws.send(JSON.stringify({ type: "updateValor", valor }));
      valorInput.value = "";
    };
  </script>
</body>

</html>